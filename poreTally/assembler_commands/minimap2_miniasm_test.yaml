# When compiling your own yaml, note the following:
# - When referring to parameters in parameter files, use curly brackets, e.g. {WD}
# - Where you would normally use curly brackets, use double curly brackets, e.g. awk {print} becomes awk {{print}}
# - Escape single quotation marks (double quotation marks are fine), e.g. echo 'foo' --> echo \'foo\'

versions:
  minimap2: 'minimap2 -V'
#  miniasm: 'miniasm -V'
description: >
  Minimap2 is a fast all-vs-all mapper of reads that relies on sketches of sequences, composed of
  minimizers. Miniasm uses the found overlaps to construct an assembly graph.
  As a consensus step is lacking in this pipeline, post-assembly polishing is often required.
commands: |
  minimap2 -x ava-ont -t {NB_THREADS} {WD}/all_reads.fastq {WD}/all_reads.fastq | gzip -1 > {WD}/assembler_results/minimap2_miniasm/minimap2.paf.gz
  miniasm -f {WD}/all_reads.fastq {WD}/assembler_results/minimap2_miniasm/minimap2.paf.gz > {{output}}
#  awk '/^S/{{{{print ">"$2"\n"$3}}}}' {WD}/assembler_results/minimap2_miniasm/minimap2_miniasm.gfa | fold > {{output}}
#  cp {WD}/assembler_results/minimap2_miniasm/minimap2_miniasm.fasta {WD}/assembler_results/all_assemblies/minimap2_miniasm.fasta
conda:
  channels:
    - bioconda
  dependencies:
    - miniasm
    - minimap2